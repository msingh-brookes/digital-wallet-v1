-- digital-wallet-starter-repo

This document contains a complete, minimal starter GitHub-style repository for a "Digital Wallet" app (backend + React web PWA). The backend uses a lightweight JSON file DB for quick local testing. The web client is a responsive React app (Vite). This is a working, runnable starter you can open, copy to a repo, and run locally.

--- REPO LAYOUT ---

README.md
backend/package.json
backend/src/index.js
backend/src/db.js
backend/src/auth.js
backend/src/routes/wallets.js
backend/src/routes/auth.js
backend/data/db.json

web/package.json
web/index.html
web/src/main.jsx
web/src/App.jsx
web/src/api.js
web/src/Login.jsx
web/src/Wallets.jsx

--- README.md ---
# Digital Wallet - Starter Repo

This repository is a compact starter for a digital wallet accessible from Android (mobile browser) and PC (desktop browser). It includes:
- **backend/**: Node + Express API with JWT auth and a tiny file-based DB (for quick local testing). Replace with Postgres in production.
- **web/**: React (Vite) single-page app that works as a PWA on mobile and desktop.

This is intentionally minimal: it provides register/login, wallets list, create wallet, and send-to-user (internal transfer). Use it to prototype and iterate.

## Quick summary (short)
1. Open two terminals.
2. Run backend: `cd backend && npm install && npm run dev` (server on http://localhost:4000)
3. Run web: `cd web && npm install && npm run dev` (web on http://localhost:5173)
4. Register two users and send money between them.

Full detailed instructions are in the repository files.

--- backend/package.json ---
{
  "name": "dw-backend",
  "version": "1.0.0",
  "main": "src/index.js",
  "scripts": {
    "dev": "node src/index.js"
  },
  "dependencies": {
    "bcryptjs": "^2.4.3",
    "cors": "^2.8.5",
    "express": "^4.18.2",
    "jsonwebtoken": "^9.0.0",
    "nanoid": "^4.0.0",
    "lowdb": "^6.0.1",
    "lodash": "^4.17.21"
  }
}

--- backend/src/db.js ---
const { Low, JSONFile } = require('lowdb');
const path = require('path');
const fs = require('fs');

const file = path.join(__dirname, '..', 'data', 'db.json');
if (!fs.existsSync(path.dirname(file))) fs.mkdirSync(path.dirname(file), { recursive: true });

const adapter = new JSONFile(file);
const db = new Low(adapter);

async function init() {
  await db.read();
  db.data = db.data || { users: [], wallets: [], transactions: [] };
  await db.write();
}

module.exports = { db, init };

--- backend/src/auth.js ---
const jwt = require('jsonwebtoken');
const JWT_SECRET = process.env.JWT_SECRET || 'dev_secret_please_change';

function generateToken(payload) {
  return jwt.sign(payload, JWT_SECRET, { expiresIn: '2h' });
}

function authMiddleware(req, res, next) {
  const auth = req.headers.authorization;
  if (!auth) return res.status(401).json({ error: 'no_auth' });
  const token = auth.replace('Bearer ', '');
  try {
    const payload = jwt.verify(token, JWT_SECRET);
    req.user = payload;
    next();
  } catch (e) { return res.status(401).json({ error: 'invalid_token' }); }
}

module.exports = { generateToken, authMiddleware };

--- backend/src/routes/auth.js ---
const express = require('express');
const bcrypt = require('bcryptjs');
const { nanoid } = require('nanoid');
const { db } = require('../db');
const { generateToken } = require('../auth');

const router = express.Router();

router.post('/register', async (req, res) => {
  const { email, password, name } = req.body;
  if (!email || !password) return res.status(400).json({ error: 'email_password_required' });
  await db.read();
  const exists = db.data.users.find(u => u.email === email);
  if (exists) return res.status(400).json({ error: 'user_exists' });
  const id = nanoid();
  const pw = await bcrypt.hash(password, 8);
  const user = { id, email, name: name || '', passwordHash: pw, createdAt: new Date().toISOString() };
  db.data.users.push(user);
  // create a default wallet
  const wallet = { id: 'w_' + nanoid(), userId: id, name: 'Personal', currency: 'USD', balanceCents: 0, createdAt: new Date().toISOString() };
  db.data.wallets.push(wallet);
  await db.write();
  const token = generateToken({ id: user.id, email: user.email });
  res.json({ user: { id: user.id, email: user.email, name: user.name }, accessToken: token });
});

router.post('/login', async (req, res) => {
  const { email, password } = req.body;
  if (!email || !password) return res.status(400).json({ error: 'email_password_required' });
  await db.read();
  const user = db.data.users.find(u => u.email === email);
  if (!user) return res.status(401).json({ error: 'invalid_credentials' });
  const ok = await bcrypt.compare(password, user.passwordHash);
  if (!ok) return res.status(401).json({ error: 'invalid_credentials' });
  const token = generateToken({ id: user.id, email: user.email });
  res.json({ user: { id: user.id, email: user.email, name: user.name }, accessToken: token });
});

module.exports = router;

--- backend/src/routes/wallets.js ---
const express = require('express');
const { nanoid } = require('nanoid');
const { db } = require('../db');

const router = express.Router();

router.get('/', async (req, res) => {
  await db.read();
  const wallets = db.data.wallets.filter(w => w.userId === req.user.id);
  res.json(wallets);
});

router.post('/', async (req, res) => {
  const { name, currency } = req.body;
  await db.read();
  const id = 'w_' + nanoid();
  const wallet = { id, userId: req.user.id, name: name || 'Wallet', currency: currency || 'USD', balanceCents: 0, createdAt: new Date().toISOString() };
  db.data.wallets.push(wallet);
  await db.write();
  res.json(wallet);
});

router.post('/:walletId/send', async (req, res) => {
  const { walletId } = req.params;
  const { toEmail, amountCents, memo } = req.body;
  if (!toEmail || !amountCents) return res.status(400).json({ error: 'toEmail_amount_required' });
  await db.read();
  const fromWallet = db.data.wallets.find(w => w.id === walletId && w.userId === req.user.id);
  if (!fromWallet) return res.status(404).json({ error: 'wallet_not_found' });
  if (fromWallet.balanceCents < amountCents) return res.status(400).json({ error: 'insufficient_funds' });
  const toUser = db.data.users.find(u => u.email === toEmail);
  if (!toUser) return res.status(404).json({ error: 'recipient_not_found' });
  const toWallet = db.data.wallets.find(w => w.userId === toUser.id);
  if (!toWallet) return res.status(500).json({ error: 'recipient_wallet_missing' });

  // ledger: create transactions
  const txOut = { id: 't_' + nanoid(), walletId: fromWallet.id, amountCents: -Math.abs(amountCents), type: 'send', memo: memo || '', createdAt: new Date().toISOString(), counterpartyEmail: toEmail };
  const txIn = { id: 't_' + nanoid(), walletId: toWallet.id, amountCents: Math.abs(amountCents), type: 'receive', memo: memo || '', createdAt: new Date().toISOString(), counterpartyEmail: req.user.email };
  db.data.transactions.push(txOut, txIn);
  fromWallet.balanceCents -= Math.abs(amountCents);
  toWallet.balanceCents += Math.abs(amountCents);
  await db.write();
  res.json({ success: true, txOut, txIn });
});

module.exports = router;

--- backend/src/index.js ---
const express = require('express');
const cors = require('cors');
const bodyParser = require('body-parser');
const { init, db } = require('./db');
const authRoutes = require('./routes/auth');
const walletRoutes = require('./routes/wallets');
const { authMiddleware } = require('./auth');

async function main(){
  await init();
  const app = express();
  app.use(cors());
  app.use(bodyParser.json());

  app.use('/api/v1/auth', authRoutes);
  app.use('/api/v1/wallets', authMiddleware, walletRoutes);

  app.get('/', (req,res)=> res.send('Digital Wallet API'));

  const port = process.env.PORT || 4000;
  app.listen(port, ()=> console.log('API listening on', port));
}

main();

--- backend/data/db.json ---
{
  "users": [],
  "wallets": [],
  "transactions": []
}

--- web/package.json ---
{
  "name": "dw-web",
  "version": "1.0.0",
  "private": true,
  "scripts": {
    "dev": "vite"
  },
  "dependencies": {
    "react": "18.2.0",
    "react-dom": "18.2.0",
    "axios": "1.4.0"
  },
  "devDependencies": {
    "vite": "5.0.0"
  }
}

--- web/index.html ---
<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Digital Wallet - Web</title>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.jsx"></script>
  </body>
</html>

--- web/src/main.jsx ---
import React from 'react'
import { createRoot } from 'react-dom/client'
import App from './App'

createRoot(document.getElementById('root')).render(<App />)

--- web/src/api.js ---
import axios from 'axios';

const API = axios.create({ baseURL: 'http://localhost:4000/api/v1' });

export function setToken(token){
  API.defaults.headers.common['Authorization'] = token ? `Bearer ${token}` : '';
}

export default API;

--- web/src/Login.jsx ---
import React, { useState } from 'react';
import API, { setToken } from './api';

export default function Login({ onLogin }){
  const [email,setEmail]=useState('');
  const [password,setPassword]=useState('');
  const [isRegister,setIsRegister]=useState(false);

  async function submit(e){
    e.preventDefault();
    try{
      const url = isRegister ? '/auth/register' : '/auth/login';
      const res = await API.post(url, { email, password, name: 'Demo' });
      const { accessToken, user } = res.data;
      setToken(accessToken);
      localStorage.setItem('dw_token', accessToken);
      localStorage.setItem('dw_user', JSON.stringify(user));
      onLogin();
    } catch(err){
      alert(err.response?.data?.error || err.message);
    }
  }

  return (
    <div style={{maxWidth:400, margin:'40px auto'}}>
      <h2>{isRegister ? 'Register' : 'Login'}</h2>
      <form onSubmit={submit}>
        <div><input placeholder="Email" value={email} onChange={e=>setEmail(e.target.value)} /></div>
        <div><input placeholder="Password" type="password" value={password} onChange={e=>setPassword(e.target.value)} /></div>
        <button type="submit">{isRegister ? 'Register' : 'Login'}</button>
      </form>
      <button onClick={()=>setIsRegister(s=>!s)} style={{marginTop:10}}>{isRegister ? 'Have an account? Login' : 'Create account'}</button>
    </div>
  );
}

--- web/src/Wallets.jsx ---
import React, { useEffect, useState } from 'react';
import API from './api';

export default function Wallets(){
  const [wallets,setWallets] = useState([]);
  const [amount,setAmount] = useState('');
  const [toEmail,setToEmail] = useState('');
  const [selected,setSelected] = useState(null);

  async function load(){
    const res = await API.get('/wallets');
    setWallets(res.data);
    if(res.data[0]) setSelected(res.data[0].id);
  }

  useEffect(()=>{ load() }, []);

  async function createWallet(){
    const name = prompt('Wallet name') || 'New';
    await API.post('/wallets', { name });
    load();
  }

  async function send(){
    if(!selected) return alert('choose wallet');
    const cents = Math.round(parseFloat(amount)*100);
    await API.post(`/wallets/${selected}/send`, { toEmail, amountCents: cents });
    setAmount(''); setToEmail('');
    load();
  }

  return (
    <div style={{maxWidth:700, margin:'20px auto'}}>
      <h2>Your wallets</h2>
      <button onClick={createWallet}>Create Wallet</button>
      <ul>
        {wallets.map(w=> (
          <li key={w.id} style={{padding:10, border: selected===w.id ? '2px solid black' : '1px solid #ddd'}} onClick={()=>setSelected(w.id)}>
            <strong>{w.name}</strong> â€” {(w.balanceCents/100).toFixed(2)} {w.currency}
          </li>
        ))}
      </ul>
      <h3>Send money</h3>
      <div>
        <input placeholder="Recipient email" value={toEmail} onChange={e=>setToEmail(e.target.value)} />
        <input placeholder="Amount" value={amount} onChange={e=>setAmount(e.target.value)} />
        <button onClick={send}>Send</button>
      </div>
    </div>
  );
}

--- web/src/App.jsx ---
import React, { useEffect, useState } from 'react';
import Login from './Login';
import Wallets from './Wallets';
import { setToken } from './api';

export default function App(){
  const [logged, setLogged] = useState(false);

  useEffect(()=>{
    const t = localStorage.getItem('dw_token');
    if(t){ setToken(t); setLogged(true); }
  }, []);

  if(!logged) return <Login onLogin={()=>setLogged(true)} />;
  return (
    <div>
      <header style={{padding:10, background:'#f4f4f4'}}>
        <h1 style={{margin:0}}>Digital Wallet (Demo)</h1>
        <button style={{float:'right'}} onClick={()=>{ localStorage.removeItem('dw_token'); localStorage.removeItem('dw_user'); setToken(null); window.location.reload(); }}>Logout</button>
      </header>
      <Wallets />
    </div>
  );
}

--- END OF REPO ---

Notes & next steps:
- This starter intentionally uses a file-based DB (lowdb) to avoid setup friction. For production, swap to Postgres and implement proper ledgers, webhook handlers for PSPs, KYC, rate limits, logging, etc.
- If you want, I can now generate: a GitHub-ready ZIP, or push this to a repository template, or convert backend to Postgres + migrations.


